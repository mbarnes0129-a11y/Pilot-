<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#f6f8ff">
  <title>DigiCoach 7-Stage — FIX v2 (Battles + Store + Uploads)</title>
  <link rel="manifest" href="manifest.json?v=fix-v2">
  <link rel="stylesheet" href="style.css?v=fix-v2">
  <script>
    window.__DIGI_VERSION__ = 'fix-v2';
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js?v=fix-v2');
      });
    }
  </script>
</head>
<body>
  <header>
    <div class="brand">🧭 DigiCoach 7-Stage</div>
    <div class="actions">
      <button id="btnSpeak" class="primary">🔊 Speak Status</button>
      <button id="btnMini">🧩 Mini HUD</button>
      <button id="btnStore">🏪 Store</button>
      <button id="btnSettings">⚙️ Settings</button>
      <button id="btnExport">⬇️ Export</button>
      <label class="import">⬆️ Import <input type="file" id="fileImport" accept="application/json" hidden></label>
      <button id="btnBypassCache">♻️ Bypass Cache</button>
    </div>
  </header>

  <main class="grid">
    <!-- Avatar card -->
    <section class="card avatar">
      <h2 id="companionNameH">Companion</h2>
      <div class="pet-wrap">
        <img id="petImg" alt="Companion avatar" />
        <div class="hpbar big"><div id="buddyHPBar"></div></div>
        <div class="hptext small" id="buddyHPText">--/--</div>
      </div>
      <div class="evo-label">
        <span id="stageName">Egg</span> • <span class="typechip" id="typeChip">Flame</span>
      </div>
      <div class="stats">
        <div class="stat"><span>Level</span><strong id="level">1</strong></div>
        <div class="stat"><span>XP</span><div class="bar"><div id="xpBar"></div></div><strong id="xpNum">0 / 100</strong></div>
        <div class="stat"><span>Coins</span><strong id="coins">0</strong></div>
        <div class="stat"><span>Mood</span><strong id="mood">🙂</strong></div>
      </div>
      <div class="avatar-actions">
        <button data-pick="1">🥚 Egg</button>
        <button data-pick="2">🌱 In Training</button>
        <button data-pick="3">🐾 Rookie</button>
        <button data-pick="4">🛡️ Champion</button>
        <button data-pick="5">⚔️ Ultimate</button>
        <button data-pick="6">🔥 Mega</button>
        <button data-pick="7">👑 Grand Mega</button>
      </div>
      <!-- Hidden inputs for stage uploads -->
      <input type="file" id="imgStage1" accept="image/*" hidden>
      <input type="file" id="imgStage2" accept="image/*" hidden>
      <input type="file" id="imgStage3" accept="image/*" hidden>
      <input type="file" id="imgStage4" accept="image/*" hidden>
      <input type="file" id="imgStage5" accept="image/*" hidden>
      <input type="file" id="imgStage6" accept="image/*" hidden>
      <input type="file" id="imgStage7" accept="image/*" hidden>
      <small class="ip-note">Tip: Tap a stage button to upload an image for that evolution.</small>
    </section>

    <!-- Daily quests -->
    <section class="card tasks">
      <h2>Daily Quests</h2>
      <ul id="taskList" class="task-list"></ul>
      <div class="task-new">
        <input id="taskInput" placeholder="New quest">
        <input id="taskXP" type="number" min="1" value="10" title="XP">
        <input id="taskCoins" type="number" min="0" value="2" title="Coins">
        <button id="addTask">➕ Add</button>
      </div>
      <small id="dailyResetNote"></small>
    </section>

    <!-- Coach -->
    <section class="card coach">
      <h2>Coach</h2>
      <div class="coach-text" id="coachText">FIX v2 loaded. Press ♻️ Bypass Cache after updating on GitHub Pages.</div>
    </section>

    <!-- Battle -->
    <section class="card battle">
      <h2>Encounter</h2>
      <div class="battle-summary">
        <div>Campaign Day: <strong id="campDay">1</strong></div>
        <div>Battle <strong id="battleNo">1</strong> of <strong>3</strong></div>
        <div>Type: <strong id="battleType">Daily</strong></div>
        <div>Extra actions: <strong id="extraPool">0</strong></div>
        <div>Status: <strong id="battleStatus">Ready</strong></div>
      </div>
      <div class="battle-actions">
        <button id="btnStartBattle" class="primary">⚔️ Start Battle</button>
      </div>
    </section>
  </main>

  <!-- Store Modal -->
  <dialog id="storeDialog">
    <div class="store">
      <h3>🏪 Digi Store</h3>
      <div class="store-grid" id="storeItems"></div>
      <div class="row right"><button id="closeStore">Close</button></div>
    </div>
  </dialog>

  <!-- Battle Modal -->
  <dialog id="battleDialog">
    <div class="battle-ui light">
      <div class="battle-foes">
        <div class="you side"><span id="youName">You</span>
          <div class="hpbar"><div id="youHPBar"></div></div>
          <div class="hptext" id="youHPText"></div>
        </div>
        <div class="vs">VS</div>
        <div class="enemy side"><span id="enemyName">Enemy</span>
          <div class="hpbar"><div id="enemyHPBar"></div></div>
          <div class="hptext" id="enemyHPText"></div>
        </div>
      </div>
      <div id="battleLog" class="battle-log"></div>
      <div class="battle-moves">
        <button id="moveA">Move 1</button>
        <button id="moveB">Move 2</button>
        <button id="moveC">Move 3</button>
        <button id="moveD">Move 4</button>
      </div>
    </div>
  </dialog>

  <script src="app.js?v=fix-v2"></script>
</body>
</html>
